<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨­å‚™é ç´„æŒ‡å—ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background: linear-gradient(135deg, #e8f5e9 0%, #e1f5fe 50%, #f3e5f5 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
            flex-direction: column;
        }

        /* ä¸»å…§å®¹å€ */
        .main-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
            flex: 1;
            width: 100%;
        }

        /* å€å¡Šæ¨£å¼ */
        .section {
            background: white;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        /* æ¨™é¡Œå€å¡Š */
        .header-section {
            text-align: center;
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .header-section h1 {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .header-section .subtitle {
            font-size: 1.1em;
            color: #666;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .section-icon {
            width: 35px;
            height: 35px;
            background: #2196F3;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .section-title {
            font-size: 1.2em;
            color: #2c3e50;
            font-weight: 600;
        }

        /* é¸é …æ¨£å¼ */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
        }

        .option-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .option-card:hover:not(.disabled) {
            border-color: #2196F3;
            background: #f0f7ff;
        }

        .option-card.selected {
            background: #e3f2fd;
            border-color: #2196F3;
        }

        .option-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #e9ecef;
        }

        .option-card.exclusive {
            border-style: dashed;
            background: #fffbf0;
        }

        .option-card.exclusive.selected {
            background: #fff8e1;
            border-color: #ff9800;
        }

        .option-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .option-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .option-label {
            font-weight: 600;
            color: #333;
            cursor: pointer;
            flex: 1;
        }

        .option-desc {
            font-size: 0.85em;
            color: #666;
            margin-left: 28px;
        }

        .sub-options {
            margin-top: 10px;
            margin-left: 28px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
        }

        .sub-option {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .sub-option label {
            font-size: 0.85em;
            color: #555;
            cursor: pointer;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .generate-button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 35px;
            font-size: 1.05em;
            font-weight: 500;
            border-radius: 25px;
            cursor: pointer;
            display: block;
            margin: 25px auto;
            transition: all 0.2s ease;
        }

        .generate-button:hover {
            background: #1976D2;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        /* çµæœå€åŸŸ */
        .results-container {
            display: none;
        }

        .results-header {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .results-title {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .results-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .summary-item {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            border-left: 3px solid #2196F3;
        }

        .summary-label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 2px;
        }

        .summary-value {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95em;
        }

        /* åˆ‡æ›æŒ‰éˆ• */
        .view-toggle {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .toggle-button {
            padding: 8px 20px;
            border: 1px solid #2196F3;
            background: white;
            color: #2196F3;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
        }

        .toggle-button.active {
            background: #2196F3;
            color: white;
        }

        .toggle-button:hover:not(.active) {
            background: #f0f7ff;
        }

        /* é ç´„æ­¥é©Ÿ */
        .booking-category {
            background: #f0f0f0;
            padding: 10px 15px;
            margin: 20px 0 10px 0;
            border-radius: 6px;
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .booking-step {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            margin-left: 20px;
            display: flex;
            gap: 12px;
        }

        .booking-step:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .step-number {
            width: 30px;
            height: 30px;
            background: #2196F3;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .step-booking {
            background: #e3f2fd;
            color: #1976D2;
            padding: 4px 10px;
            border-radius: 15px;
            display: inline-block;
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .step-note {
            color: #666;
            font-size: 0.85em;
            line-height: 1.4;
        }

        .step-time {
            font-size: 0.8em;
            margin-top: 4px;
        }

        .time-available {
            color: #4CAF50;
            margin-right: 10px;
        }

        .time-unavailable {
            color: #f44336;
        }

        .optional-tag {
            background: #FFC107;
            color: #795548;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: 500;
            margin-left: 6px;
        }

        /* æç¤ºæ¡† */
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 12px 18px;
            border-radius: 6px;
            margin: 15px 0;
            display: flex;
            gap: 10px;
            font-size: 0.9em;
        }

        .info-icon {
            color: #2196F3;
            font-size: 18px;
            flex-shrink: 0;
        }

        .reset-button {
            background: #757575;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }

        .reset-button:hover {
            background: #616161;
        }

        /* è¼‰å…¥å‹•ç•« */
        .loading {
            display: none;
            text-align: center;
            padding: 50px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2196F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* é å°¾ */
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: #666;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .footer strong {
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- ä¸»å…§å®¹ -->
    <div class="main-container">
        <div id="selectionForm">
            <!-- æ¨™é¡Œå€å¡Š -->
            <div class="header-section">
                <h1>TPS 24A1 è¨­å‚™èˆ‡æŠ€è¡“æ”¯æ´é ç´„æŒ‡å—</h1>
                <p class="subtitle">æ ¹æ“šæ‚¨çš„æ¨£æœ¬é¡å‹èˆ‡ä½¿ç”¨è€…èº«ä»½ï¼Œç‚ºæ‚¨æä¾›æœ€é©åˆçš„é ç´„æµç¨‹</p>
            </div>

            <!-- A. æ¨£æœ¬ç¨®é¡ -->
            <div class="section">
                <div class="section-header">
                    <div class="section-icon">A</div>
                    <h2 class="section-title">æ¨£æœ¬ç¨®é¡é¸æ“‡</h2>
                </div>
                <div class="options-grid">
                    <div class="option-card" onclick="selectSample('room-temp')">
                        <div class="option-header">
                            <input type="radio" name="sample" value="room-temp" class="option-checkbox">
                            <label class="option-label">å¸¸æº«è‡ªå‚™æ¨£æœ¬</label>
                        </div>
                        <div class="option-desc">å·²æº–å‚™å¥½çš„å¸¸æº«æ¨£æœ¬ï¼Œå¯ç›´æ¥é€²è¡Œå¯¦é©—</div>
                    </div>
                    <div class="option-card" onclick="selectSample('adherent')">
                        <div class="option-header">
                            <input type="radio" name="sample" value="adherent" class="option-checkbox">
                            <label class="option-label">è²¼ç›¤ç´°èƒ</label>
                        </div>
                        <div class="option-desc">éœ€è¦åŸ¹é¤Šçš„è²¼é™„å‹ç´°èƒæ¨£æœ¬</div>
                    </div>
                    <div class="option-card" onclick="selectSample('suspension')">
                        <div class="option-header">
                            <input type="radio" name="sample" value="suspension" class="option-checkbox">
                            <label class="option-label">æ‡¸æµ®ç´°èƒ</label>
                        </div>
                        <div class="option-desc">æ‡¸æµ®åŸ¹é¤Šçš„ç´°èƒæ¨£æœ¬</div>
                    </div>
                </div>
            </div>

            <!-- B. ç›®å‰èº«ä»½ -->
            <div class="section">
                <div class="section-header">
                    <div class="section-icon">B</div>
                    <h2 class="section-title">ç›®å‰ä½¿ç”¨è€…èº«ä»½ï¼ˆå¯è¤‡é¸ï¼‰</h2>
                </div>
                <div class="options-grid">
                    <div class="option-card exclusive" onclick="toggleCurrent('none')">
                        <div class="option-header">
                            <input type="checkbox" id="current-none" class="option-checkbox">
                            <label class="option-label">ä¸€èˆ¬ä½¿ç”¨è€…</label>
                        </div>
                        <div class="option-desc">å°šæœªå–å¾—ä»»ä½• Superuser è³‡æ ¼</div>
                    </div>
                    <div class="option-card" onclick="toggleCurrent('plunge')">
                        <div class="option-header">
                            <input type="checkbox" id="current-plunge" class="option-checkbox">
                            <label class="option-label">æ€¥è¡å¼å†·å‡å„€ Superuser</label>
                        </div>
                        <div class="option-desc">å·²å–å¾—æ€¥è¡å¼å†·å‡å„€æ“ä½œè³‡æ ¼</div>
                        <div class="sub-options" style="display:none;" id="plunge-mode">
                            <div class="sub-option">
                                <input type="radio" id="plunge-self" name="plunge-mode" value="self" checked>
                                <label for="plunge-self">è‡ªè¡Œæ“ä½œï¼ˆ00:00-24:00ï¼‰</label>
                            </div>
                            <div class="sub-option">
                                <input type="radio" id="plunge-assist" name="plunge-mode" value="assist">
                                <label for="plunge-assist">éœ€è¦å”ä½œï¼ˆ09:00-18:00ï¼‰</label>
                            </div>
                        </div>
                    </div>
                    <div class="option-card" onclick="toggleCurrent('screen')">
                        <div class="option-header">
                            <input type="checkbox" id="current-screen" class="option-checkbox">
                            <label class="option-label">å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å° Superuser</label>
                        </div>
                        <div class="option-desc">å·²å–å¾—ç¯©é¸è¼‰å°æ“ä½œè³‡æ ¼</div>
                    </div>
                    <div class="option-card" onclick="toggleCurrent('sxt')">
                        <div class="option-header">
                            <input type="checkbox" id="current-sxt" class="option-checkbox">
                            <label class="option-label">SXTå¯¦é©—ç«™ Superuser</label>
                        </div>
                        <div class="option-desc">å·²å–å¾—SXTå¯¦é©—ç«™æ“ä½œè³‡æ ¼</div>
                        <div class="sub-options" style="display:none;" id="sxt-mode">
                            <div class="sub-option">
                                <input type="radio" id="sxt-self" name="sxt-mode" value="self" checked>
                                <label for="sxt-self">è‡ªè¡Œæ“ä½œï¼ˆ00:00-24:00ï¼‰</label>
                            </div>
                            <div class="sub-option">
                                <input type="radio" id="sxt-assist" name="sxt-mode" value="assist">
                                <label for="sxt-assist">éœ€è¦å”ä½œï¼ˆ09:00-18:00ï¼‰</label>
                            </div>
                        </div>
                    </div>
                    <div class="option-card" onclick="toggleCurrent('amira')">
                        <div class="option-header">
                            <input type="checkbox" id="current-amira" class="option-checkbox">
                            <label class="option-label">Amiraå½±åƒåˆ†å‰²å·¥ä½œç«™ Superuser</label>
                        </div>
                        <div class="option-desc">å·²å–å¾—å½±åƒåˆ†å‰²å·¥ä½œç«™æ“ä½œè³‡æ ¼</div>
                    </div>
                </div>
            </div>

            <!-- C. ç›®æ¨™èº«ä»½ -->
            <div class="section">
                <div class="section-header">
                    <div class="section-icon">C</div>
                    <h2 class="section-title">æœŸæœ›é”æˆçš„ä½¿ç”¨è€…èº«ä»½ï¼ˆå¯è¤‡é¸ï¼‰</h2>
                </div>
                <div class="options-grid">
                    <div class="option-card exclusive" onclick="toggleTarget('maintain')">
                        <div class="option-header">
                            <input type="checkbox" id="target-maintain" class="option-checkbox">
                            <label class="option-label">ç¶­æŒåŸæœ‰ä½¿ç”¨è€…èº«ä»½</label>
                        </div>
                        <div class="option-desc">ä¸éœ€è¦æ¥å—ä»»ä½•æ–°çš„æ•™è‚²è¨“ç·´</div>
                    </div>
                    <div class="option-card" onclick="toggleTarget('plunge')">
                        <div class="option-header">
                            <input type="checkbox" id="target-plunge" class="option-checkbox">
                            <label class="option-label">æ€¥è¡å¼å†·å‡å„€ Superuser</label>
                        </div>
                        <div class="option-desc">å­¸ç¿’æ“ä½œæ€¥è¡å¼å†·å‡å„€</div>
                    </div>
                    <div class="option-card" onclick="toggleTarget('screen')">
                        <div class="option-header">
                            <input type="checkbox" id="target-screen" class="option-checkbox">
                            <label class="option-label">å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å° Superuser</label>
                        </div>
                        <div class="option-desc">å­¸ç¿’æ“ä½œç¯©é¸è¼‰å°</div>
                    </div>
                    <div class="option-card" onclick="toggleTarget('sxt')">
                        <div class="option-header">
                            <input type="checkbox" id="target-sxt" class="option-checkbox">
                            <label class="option-label">SXTå¯¦é©—ç«™ Superuser</label>
                        </div>
                        <div class="option-desc">å­¸ç¿’æ“ä½œSXTå¯¦é©—ç«™</div>
                    </div>
                    <div class="option-card" onclick="toggleTarget('amira')">
                        <div class="option-header">
                            <input type="checkbox" id="target-amira" class="option-checkbox">
                            <label class="option-label">Amiraå½±åƒåˆ†å‰²å·¥ä½œç«™ Superuser</label>
                        </div>
                        <div class="option-desc">å­¸ç¿’æ“ä½œå½±åƒåˆ†å‰²å·¥ä½œç«™</div>
                    </div>
                </div>
            </div>

            <button class="generate-button" onclick="generateGuide()">ç”Ÿæˆå°ˆå±¬é ç´„æŒ‡å—</button>
        </div>

        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨ç”Ÿæˆæ‚¨çš„å°ˆå±¬é ç´„æŒ‡å—...</p>
        </div>

        <div id="results" class="results-container"></div>
    </div>

    <!-- é å°¾ -->
    <footer class="footer">
        <strong>NSRRC TPS 24A1 Booking Guide ğŸš€ v1.0 | July 2025</strong><br>
        Developed by Chia-Chun Hsieh | hsieh.cc@nsrrc.org.tw
    </footer>

    <script>
        let selectedSample = '';
        let currentStatus = [];
        let targetStatus = [];
        let viewMode = 'sequence'; // 'sequence' or 'category'

        function selectSample(type) {
            selectedSample = type;
            document.querySelectorAll('input[name="sample"]').forEach(radio => {
                radio.checked = radio.value === type;
                radio.closest('.option-card').classList.toggle('selected', radio.checked);
            });
            
            // å¦‚æœé¸æ“‡å¸¸æº«è‡ªå‚™æ¨£æœ¬ï¼Œç¦ç”¨Bå’ŒCçš„æŸäº›é¸é …
            if (type === 'room-temp') {
                // ç¦ç”¨Bå€å¡Šçš„é¸é …
                ['plunge', 'screen'].forEach(id => {
                    const bOption = document.getElementById(`current-${id}`).closest('.option-card');
                    bOption.classList.add('disabled');
                    document.getElementById(`current-${id}`).checked = false;
                    document.getElementById(`current-${id}`).disabled = true;
                    bOption.classList.remove('selected');
                    
                    // ç¦ç”¨Cå€å¡Šçš„é¸é …
                    const cOption = document.getElementById(`target-${id}`).closest('.option-card');
                    cOption.classList.add('disabled');
                    document.getElementById(`target-${id}`).checked = false;
                    document.getElementById(`target-${id}`).disabled = true;
                    cOption.classList.remove('selected');
                });
                currentStatus = currentStatus.filter(s => !['plunge', 'screen'].includes(s));
                targetStatus = targetStatus.filter(s => !['plunge', 'screen'].includes(s));
                
                // éš±è—ç›¸é—œå­é¸é …
                document.getElementById('plunge-mode').style.display = 'none';
            } else {
                // æ¢å¾©Bå’ŒCå€å¡Šçš„é¸é …
                ['plunge', 'screen'].forEach(id => {
                    const bOption = document.getElementById(`current-${id}`).closest('.option-card');
                    bOption.classList.remove('disabled');
                    document.getElementById(`current-${id}`).disabled = false;
                    
                    const cOption = document.getElementById(`target-${id}`).closest('.option-card');
                    cOption.classList.remove('disabled');
                    document.getElementById(`target-${id}`).disabled = false;
                });
                updateMutualExclusion();
            }
        }

        function toggleCurrent(type) {
            const checkbox = document.getElementById(`current-${type}`);
            const card = checkbox.closest('.option-card');
            
            if (checkbox.disabled) return;
            
            checkbox.checked = !checkbox.checked;
            card.classList.toggle('selected', checkbox.checked);
            
            if (type === 'none' && checkbox.checked) {
                // é¸æ“‡ä¸€èˆ¬ä½¿ç”¨è€…æ™‚
                ['plunge', 'screen', 'sxt', 'amira'].forEach(t => {
                    const el = document.getElementById(`current-${t}`);
                    el.checked = false;
                    el.closest('.option-card').classList.remove('selected');
                    document.getElementById(`${t}-mode`)?.style && (document.getElementById(`${t}-mode`).style.display = 'none');
                });
                currentStatus = ['none'];
                
                // Cå€å¡Šçš„ç‰¹æ®Šè™•ç†
                const maintainEl = document.getElementById('target-maintain');
                maintainEl.closest('.option-card').classList.add('disabled');
                maintainEl.disabled = true;
                maintainEl.checked = false;
                maintainEl.closest('.option-card').classList.remove('selected');
                
                // è‡ªå‹•å‹¾é¸å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å°ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                if (!selectedSample || selectedSample !== 'room-temp') {
                    const screenEl = document.getElementById('target-screen');
                    if (!screenEl.disabled) {
                        screenEl.checked = true;
                        screenEl.closest('.option-card').classList.add('selected');
                        if (!targetStatus.includes('screen')) {
                            targetStatus.push('screen');
                        }
                    }
                }
                
                targetStatus = targetStatus.filter(s => s !== 'maintain');
            } else if (type !== 'none' && checkbox.checked) {
                // é¸æ“‡ä»»ä½•superuseræ™‚ï¼Œå–æ¶ˆä¸€èˆ¬ä½¿ç”¨è€…
                const noneEl = document.getElementById('current-none');
                noneEl.checked = false;
                noneEl.closest('.option-card').classList.remove('selected');
                currentStatus = currentStatus.filter(s => s !== 'none');
                
                if (!currentStatus.includes(type)) {
                    currentStatus.push(type);
                }
                
                // æ¢å¾©Cå€å¡Šçš„ç¶­æŒåŸæœ‰èº«ä»½é¸é …
                const maintainEl = document.getElementById('target-maintain');
                maintainEl.closest('.option-card').classList.remove('disabled');
                maintainEl.disabled = false;
                
                // é¡¯ç¤ºæ“ä½œæ¨¡å¼é¸é …
                if (['plunge', 'sxt'].includes(type)) {
                    document.getElementById(`${type}-mode`).style.display = 'block';
                }
            } else {
                currentStatus = currentStatus.filter(s => s !== type);
                if (['plunge', 'sxt'].includes(type)) {
                    document.getElementById(`${type}-mode`).style.display = 'none';
                }
                
                // å¦‚æœå–æ¶ˆæ‰€æœ‰é¸é …ï¼Œæ¢å¾©Cå€å¡Šçš„ç¶­æŒåŸæœ‰èº«ä»½
                if (currentStatus.length === 0) {
                    const maintainEl = document.getElementById('target-maintain');
                    maintainEl.closest('.option-card').classList.remove('disabled');
                    maintainEl.disabled = false;
                }
            }
            
            updateMutualExclusion();
        }

        function toggleTarget(type) {
            const checkbox = document.getElementById(`target-${type}`);
            const card = checkbox.closest('.option-card');
            
            if (checkbox.disabled) return;
            
            checkbox.checked = !checkbox.checked;
            card.classList.toggle('selected', checkbox.checked);
            
            if (type === 'maintain' && checkbox.checked) {
                // ç¶­æŒåŸæœ‰èº«åˆ†æ™‚ï¼Œå–æ¶ˆå…¶ä»–é¸é …
                ['plunge', 'screen', 'sxt', 'amira'].forEach(t => {
                    const el = document.getElementById(`target-${t}`);
                    el.checked = false;
                    el.closest('.option-card').classList.remove('selected');
                });
                targetStatus = ['maintain'];
            } else if (type !== 'maintain' && checkbox.checked) {
                // é¸æ“‡ä»»ä½•superuseræ™‚ï¼Œå–æ¶ˆç¶­æŒåŸæœ‰èº«åˆ†
                const maintainEl = document.getElementById('target-maintain');
                maintainEl.checked = false;
                maintainEl.closest('.option-card').classList.remove('selected');
                targetStatus = targetStatus.filter(s => s !== 'maintain');
                
                if (!targetStatus.includes(type)) {
                    targetStatus.push(type);
                }
            } else {
                targetStatus = targetStatus.filter(s => s !== type);
                
                // ç‰¹æ®Šè™•ç†ï¼šå¦‚æœå–æ¶ˆCçš„å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å°ï¼Œä¸”Bæ˜¯ä¸€èˆ¬ä½¿ç”¨è€…ï¼Œå‰‡Bä¹Ÿè¦å–æ¶ˆ
                if (type === 'screen' && currentStatus.includes('none')) {
                    const noneEl = document.getElementById('current-none');
                    noneEl.checked = false;
                    noneEl.closest('.option-card').classList.remove('selected');
                    currentStatus = currentStatus.filter(s => s !== 'none');
                    
                    // æ¢å¾©Cå€å¡Šçš„ç¶­æŒåŸæœ‰èº«ä»½é¸é …
                    const maintainEl = document.getElementById('target-maintain');
                    maintainEl.closest('.option-card').classList.remove('disabled');
                    maintainEl.disabled = false;
                }
            }
            
            updateMutualExclusion();
        }

        function updateMutualExclusion() {
            // å¦‚æœæ˜¯å¸¸æº«è‡ªå‚™æ¨£æœ¬ï¼ŒæŸäº›é¸é …å§‹çµ‚ç¦ç”¨
            if (selectedSample === 'room-temp') {
                ['plunge', 'screen'].forEach(type => {
                    document.getElementById(`target-${type}`).closest('.option-card').classList.add('disabled');
                    document.getElementById(`target-${type}`).disabled = true;
                });
            } else {
                // Bå½±éŸ¿Cï¼šæ ¹æ“šç•¶å‰èº«ä»½ç¦ç”¨å°æ‡‰çš„ç›®æ¨™é¸é …
                ['plunge', 'screen', 'sxt', 'amira'].forEach(type => {
                    const targetOption = document.getElementById(`target-${type}`);
                    const targetCard = targetOption.closest('.option-card');
                    
                    if (currentStatus.includes(type)) {
                        targetCard.classList.add('disabled');
                        targetOption.disabled = true;
                        targetOption.checked = false;
                        targetCard.classList.remove('selected');
                        targetStatus = targetStatus.filter(t => t !== type);
                    } else {
                        targetCard.classList.remove('disabled');
                        targetOption.disabled = false;
                    }
                });
                
                // Cå½±éŸ¿Bï¼šæ ¹æ“šç›®æ¨™èº«ä»½ç¦ç”¨å°æ‡‰çš„ç•¶å‰é¸é …
                ['plunge', 'screen', 'sxt', 'amira'].forEach(type => {
                    const currentOption = document.getElementById(`current-${type}`);
                    const currentCard = currentOption.closest('.option-card');
                    
                    if (targetStatus.includes(type)) {
                        currentCard.classList.add('disabled');
                        currentOption.disabled = true;
                        currentOption.checked = false;
                        currentCard.classList.remove('selected');
                        currentStatus = currentStatus.filter(s => s !== type);
                        // éš±è—å­é¸é …
                        if (['plunge', 'sxt'].includes(type)) {
                            document.getElementById(`${type}-mode`).style.display = 'none';
                        }
                    } else if (!currentStatus.includes('none')) {
                        currentCard.classList.remove('disabled');
                        currentOption.disabled = false;
                    }
                });
            }
        }

        // é˜²æ­¢å­é¸é …é»æ“Šäº‹ä»¶å†’æ³¡
        document.querySelectorAll('.sub-options').forEach(subOptions => {
            subOptions.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        });

        // é˜²æ­¢ checkbox é»æ“Šäº‹ä»¶å†’æ³¡
        document.querySelectorAll('.option-checkbox').forEach(checkbox => {
            checkbox.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        });

        function generateGuide() {
            if (!selectedSample) {
                alert('è«‹é¸æ“‡æ¨£æœ¬ç¨®é¡');
                return;
            }
            
            if (currentStatus.length === 0) {
                alert('è«‹é¸æ“‡ç›®å‰èº«ä»½');
                return;
            }
            
            if (targetStatus.length === 0) {
                alert('è«‹é¸æ“‡æœŸæœ›é”æˆçš„èº«ä»½');
                return;
            }
            
            // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
            document.getElementById('loading').style.display = 'block';
            document.getElementById('selectionForm').style.display = 'none';

            // æ¨¡æ“¬è¼‰å…¥æ™‚é–“
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                displayResults();
            }, 800);
        }

        function displayResults() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';

            const plungeMode = document.querySelector('input[name="plunge-mode"]:checked')?.value || 'self';
            const sxtMode = document.querySelector('input[name="sxt-mode"]:checked')?.value || 'self';

            // æ¨™é¡Œå’Œæ‘˜è¦
            let html = `
                <div class="section">
                    <div class="results-header">
                        <h2 class="results-title">ğŸ“‹ æ‚¨çš„å°ˆå±¬é ç´„æŒ‡å—</h2>
                        <div class="results-summary">
                            <div class="summary-item">
                                <div class="summary-label">æ¨£æœ¬ç¨®é¡</div>
                                <div class="summary-value">${getSampleName(selectedSample)}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">ç›®å‰èº«ä»½</div>
                                <div class="summary-value">${getCurrentStatusDisplay()}</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">ç›®æ¨™èº«ä»½</div>
                                <div class="summary-value">${getTargetStatusDisplay()}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="view-toggle">
                        <button class="toggle-button active" onclick="switchView('sequence')">å¯¦é©—é †åº</button>
                        <button class="toggle-button" onclick="switchView('category')">é ç´„é …ç›®åˆ†é¡</button>
                    </div>
                    
                    <div id="booking-content">
                        ${generateBookingSteps()}
                    </div>
                    
                    <button class="reset-button" onclick="resetForm()">é‡æ–°é¸æ“‡</button>
                </div>
            `;

            resultsDiv.innerHTML = html;
        }

        function switchView(mode) {
            viewMode = mode;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.toggle-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // é‡æ–°ç”Ÿæˆå…§å®¹
            document.getElementById('booking-content').innerHTML = generateBookingSteps();
        }

        function getSampleName(type) {
            const names = {
                'room-temp': 'å¸¸æº«è‡ªå‚™æ¨£æœ¬',
                'adherent': 'è²¼ç›¤ç´°èƒ',
                'suspension': 'æ‡¸æµ®ç´°èƒ'
            };
            return names[type] || type;
        }

        function getCurrentStatusDisplay() {
            if (currentStatus.includes('none')) return 'ä¸€èˆ¬ä½¿ç”¨è€…';
            return currentStatus.map(s => getStatusName(s)).join('ã€');
        }

        function getTargetStatusDisplay() {
            if (targetStatus.includes('maintain')) return 'ç¶­æŒåŸæœ‰èº«ä»½';
            return targetStatus.map(s => getStatusName(s)).join('ã€');
        }

        function getStatusName(status) {
            const names = {
                'plunge': 'æ€¥è¡å¼å†·å‡å„€',
                'screen': 'å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å°',
                'sxt': 'SXTå¯¦é©—ç«™',
                'amira': 'Amiraå½±åƒåˆ†å‰²å·¥ä½œç«™'
            };
            return names[status] || status;
        }

        function generateBookingSteps() {
            const plungeMode = document.querySelector('input[name="plunge-mode"]:checked')?.value || 'self';
            const sxtMode = document.querySelector('input[name="sxt-mode"]:checked')?.value || 'self';
            
            let steps = [];
            let html = '';

            if (selectedSample === 'room-temp') {
                // å¸¸æº«è‡ªå‚™æ¨£æœ¬æµç¨‹
                
                // SXTå¯¦é©—ç«™
                if (currentStatus.includes('sxt')) {
                    if (sxtMode === 'self') {
                        steps.push({
                            category: 'è¨­å‚™é ç´„ (Superuser ONLY)',
                            title: 'å¯¦é©—ç«™ä¸Šæ©Ÿ (beamtime)',
                            booking: '07. SXTå¯¦é©—ç«™ (Superuser ONLY)',
                            note: 'å·²å–å¾—è³‡æ ¼ï¼Œå¯24å°æ™‚è‡ªè¡Œæ“ä½œ',
                            time: 'âœ… é€±é–“09:00-18:00',
                            timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                        });
                    } else {
                        steps.push({
                            category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                            title: 'å¯¦é©—ç«™ä¸Šæ©Ÿ (beamtime)',
                            booking: 'ç„¡éœ€é ç´„',
                            note: 'å·¥ä½œæ™‚é–“å…§ç›´æ¥è¯ç¹«å¯¦é©—ç«™äººå“¡',
                            time: 'âœ… é€±é–“09:00-18:00',
                            timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                        });
                    }
                } else if (targetStatus.includes('sxt')) {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'å¯¦é©—ç«™ä¸Šæ©Ÿ (beamtime)',
                        booking: '07. SXTå¯¦é©—ç«™ (è¨“ç·´èª²ç¨‹)',
                        note: 'åˆæ¬¡ä½¿ç”¨ï¼Œéœ€æ¥å—å®Œæ•´æ•™è‚²è¨“ç·´',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                } else {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'å¯¦é©—ç«™ä¸Šæ©Ÿ (beamtime)',
                        booking: '07. SXTå¯¦é©—ç«™ (è¨“ç·´èª²ç¨‹)',
                        note: 'å¯¦é©—ç«™äººå“¡å…¨ç¨‹å”åŠ©æ“ä½œ',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                }
                
                // æŠ€è¡“æ”¯æ´
                steps.push({
                    category: 'æŠ€è¡“æ”¯æ´',
                    title: 'å½±åƒ3DåŒ–',
                    booking: '09. Imodå½±åƒé‡å»º (è¨“ç·´èª²ç¨‹)',
                    note: 'å­¸ç¿’å°‡æ—‹è½‰å½±åƒé‡å»ºç‚º3Då †ç–Šå½±åƒ',
                    optional: true,
                    time: 'âœ… é€±é–“09:00-18:00',
                    timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                });
                
                steps.push({
                    category: 'æŠ€è¡“æ”¯æ´',
                    title: '3Då½±åƒå¥—è‰²',
                    booking: '10. 3dmodå½±åƒåˆ†å‰² (è¨“ç·´èª²ç¨‹) æˆ– 10. Amiraå½±åƒåˆ†å‰² (è¨“ç·´èª²ç¨‹)',
                    note: 'é‡å°ä¸åŒçµæ§‹é€²è¡Œè¦–è¦ºåŒ–æ¨™è¨˜',
                    optional: true,
                    time: 'âœ… é€±é–“09:00-18:00',
                    timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                });
                
                if (currentStatus.includes('amira') || targetStatus.includes('amira')) {
                    steps.push({
                        category: 'è¨­å‚™é ç´„ (Superuser ONLY)',
                        title: 'Amiraå½±åƒåˆ†å‰²å·¥ä½œç«™',
                        booking: '08. Amiraå½±åƒåˆ†å‰²å·¥ä½œç«™ (Superuser ONLY)',
                        note: 'ä½¿ç”¨é«˜æ•ˆèƒ½å·¥ä½œç«™é€²è¡Œé€²éšåˆ†æ',
                        optional: true,
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                }
                
                steps.push({
                    category: 'æŠ€è¡“æ”¯æ´',
                    title: 'è³‡æ–™åˆ†æèˆ‡è¨è«–',
                    booking: '11. è³‡æ–™åˆ†æèˆ‡è¨è«– (å”ä½œ)',
                    note: 'å¯é¸æ“‡å¯¦é«”æˆ–ç·šä¸Šè¨è«–æ–¹å¼',
                    optional: true,
                    time: 'âœ… é€±é–“09:00-18:00',
                    timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                });
                
            } else if (selectedSample === 'adherent') {
                // è²¼ç›¤ç´°èƒæµç¨‹
                
                steps.push({
                    category: 'è¨­å‚™é ç´„',
                    title: 'ç´°èƒåŸ¹é¤Š',
                    booking: '01. äºŒæ°§åŒ–ç¢³åŸ¹é¤Šç®±',
                    note: 'åƒ…éœ€é ç´„é¦–å°æ™‚ï¼ŒçµæŸæ™‚é–“ç”±å¯¦é©—ç«™èª¿æ•´',
                    time: 'âœ… é€±é–“09:00-18:00',
                    timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                });
                
                steps.push({
                    category: 'è¨­å‚™é ç´„',
                    title: 'ç´°èƒæ“ä½œ',
                    booking: '02. ç”Ÿç‰©å®‰å…¨æ“ä½œæ«ƒ',
                    note: 'ä¾éœ€æ±‚é ä¼°æ“ä½œæ™‚é–“ (ç¨®æ¤/åˆºæ¿€/æŸ“è‰²)',
                    time: 'âœ… é€±é–“09:00-18:00',
                    timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                });
                
                steps.push({
                    category: 'è¨­å‚™é ç´„',
                    title: 'ç´°èƒè§€å¯Ÿ',
                    booking: '03. å€’ç«‹å¼è¢å…‰é¡¯å¾®é¡',
                    note: 'ä¾éœ€æ±‚é ä¼°è§€å¯Ÿæ™‚é–“',
                    time: 'âœ… é€±é–“09:00-18:00',
                    timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                });
                
                // æ€¥è¡å¼å†·å‡å„€
                if (currentStatus.includes('plunge')) {
                    if (plungeMode === 'self') {
                        steps.push({
                            category: 'è¨­å‚™é ç´„ (Superuser ONLY)',
                            title: 'æ¨£æœ¬å†·å‡',
                            booking: '04. æ€¥è¡å¼å†·å‡å„€ (Superuser ONLY)',
                            note: 'å·²å–å¾—è³‡æ ¼ï¼Œå¯24å°æ™‚è‡ªè¡Œæ“ä½œ',
                            time: 'âœ… é€±é–“09:00-18:00',
                            timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                        });
                    } else {
                        steps.push({
                            category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                            title: 'æ¨£æœ¬å†·å‡',
                            booking: '04. æ€¥è¡å¼å†·å‡å„€ (å”ä½œ/è¨“ç·´èª²ç¨‹)',
                            note: 'éœ€è¦å¯¦é©—ç«™äººå“¡å”åŠ©æ“ä½œ',
                            time: 'âœ… é€±é–“09:00-18:00',
                            timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                        });
                    }
                } else if (targetStatus.includes('plunge')) {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'æ¨£æœ¬å†·å‡',
                        booking: '04. æ€¥è¡å¼å†·å‡å„€ (å”ä½œ/è¨“ç·´èª²ç¨‹)',
                        note: 'æ¥å—æ•™è‚²è¨“ç·´ä»¥å–å¾—æ“ä½œè³‡æ ¼',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                } else {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'æ¨£æœ¬å†·å‡',
                        booking: '04. æ€¥è¡å¼å†·å‡å„€ (å”ä½œ/è¨“ç·´èª²ç¨‹)',
                        note: 'å¯¦é©—ç«™äººå“¡å”åŠ©é€²è¡Œæ¨£æœ¬å†·å‡',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                }
                
                // å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å°
                if (currentStatus.includes('screen')) {
                    steps.push({
                        category: 'è¨­å‚™é ç´„ (Superuser ONLY)',
                        title: 'å†·å‡æ¨£æœ¬ç¯©é¸',
                        booking: '05. å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å° (Superuser ONLY)',
                        note: 'å·²å–å¾—è³‡æ ¼ï¼Œå¯è‡ªè¡Œæ“ä½œ',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                } else if (targetStatus.includes('screen')) {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'å†·å‡æ¨£æœ¬ç¯©é¸',
                        booking: '05. å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å° (è¨“ç·´èª²ç¨‹)',
                        note: 'æ¥å—æ•™è‚²è¨“ç·´ä»¥å–å¾—æ“ä½œè³‡æ ¼',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                } else {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'å†·å‡æ¨£æœ¬ç¯©é¸',
                        booking: '05. å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å° (è¨“ç·´èª²ç¨‹)',
                        note: 'å¯¦é©—ç«™äººå“¡å”åŠ©é€²è¡Œæ¨£æœ¬ç¯©é¸',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                }
                
                // SXTå¯¦é©—ç«™
                if (currentStatus.includes('sxt')) {
                    if (sxtMode === 'self') {
                        steps.push({
                            category: 'è¨­å‚™é ç´„ (Superuser ONLY)',
                            title: 'å¯¦é©—ç«™ä¸Šæ©Ÿ (beamtime)',
                            booking: '07. SXTå¯¦é©—ç«™ (Superuser ONLY)',
                            note: 'å·²å–å¾—è³‡æ ¼ï¼Œå¯24å°æ™‚è‡ªè¡Œæ“ä½œ',
                            time: 'âœ… é€±é–“09:00-18:00',
                            timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                        });
                    } else {
                        steps.push({
                            category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                            title: 'å¯¦é©—ç«™ä¸Šæ©Ÿ (beamtime)',
                            booking: 'ç„¡éœ€é ç´„',
                            note: 'å·¥ä½œæ™‚é–“å…§ç›´æ¥è¯ç¹«å¯¦é©—ç«™äººå“¡',
                            time: 'âœ… é€±é–“09:00-18:00',
                            timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                        });
                    }
                } else if (targetStatus.includes('sxt')) {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'å¯¦é©—ç«™ä¸Šæ©Ÿ (beamtime)',
                        booking: '07. SXTå¯¦é©—ç«™ (è¨“ç·´èª²ç¨‹)',
                        note: 'åˆæ¬¡ä½¿ç”¨ï¼Œéœ€æ¥å—å®Œæ•´æ•™è‚²è¨“ç·´',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                } else {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'å¯¦é©—ç«™ä¸Šæ©Ÿ (beamtime)',
                        booking: '07. SXTå¯¦é©—ç«™ (è¨“ç·´èª²ç¨‹)',
                        note: 'å¯¦é©—ç«™äººå“¡å…¨ç¨‹å”åŠ©æ“ä½œ',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                }
                
                // æŠ€è¡“æ”¯æ´
                steps.push({
                    category: 'æŠ€è¡“æ”¯æ´',
                    title: 'å½±åƒ3DåŒ–',
                    booking: '09. Imodå½±åƒé‡å»º (è¨“ç·´èª²ç¨‹)',
                    note: 'å­¸ç¿’å°‡æ—‹è½‰å½±åƒé‡å»ºç‚º3Då †ç–Šå½±åƒ',
                    optional: true,
                    time: 'âœ… é€±é–“09:00-18:00',
                    timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                });
                
                steps.push({
                    category: 'æŠ€è¡“æ”¯æ´',
                    title: '3Då½±åƒå¥—è‰²',
                    booking: '10. 3dmodå½±åƒåˆ†å‰² (è¨“ç·´èª²ç¨‹) æˆ– 10. Amiraå½±åƒåˆ†å‰² (è¨“ç·´èª²ç¨‹)',
                    note: 'é‡å°ä¸åŒçµæ§‹é€²è¡Œè¦–è¦ºåŒ–æ¨™è¨˜',
                    optional: true,
                    time: 'âœ… é€±é–“09:00-18:00',
                    timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                });
                
                if (currentStatus.includes('amira') || targetStatus.includes('amira')) {
                    steps.push({
                        category: 'è¨­å‚™é ç´„ (Superuser ONLY)',
                        title: 'Amiraå½±åƒåˆ†å‰²å·¥ä½œç«™',
                        booking: '08. Amiraå½±åƒåˆ†å‰²å·¥ä½œç«™ (Superuser ONLY)',
                        note: 'ä½¿ç”¨é«˜æ•ˆèƒ½å·¥ä½œç«™é€²è¡Œé€²éšåˆ†æ',
                        optional: true,
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                }
                
                steps.push({
                    category: 'æŠ€è¡“æ”¯æ´',
                    title: 'è³‡æ–™åˆ†æèˆ‡è¨è«–',
                    booking: '11. è³‡æ–™åˆ†æèˆ‡è¨è«– (å”ä½œ)',
                    note: 'å¯é¸æ“‡å¯¦é«”æˆ–ç·šä¸Šè¨è«–æ–¹å¼',
                    optional: true,
                    time: 'âœ… é€±é–“09:00-18:00',
                    timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                });
                
            } else if (selectedSample === 'suspension') {
                // æ‡¸æµ®ç´°èƒæµç¨‹
                
                // æ€¥è¡å¼å†·å‡å„€
                if (currentStatus.includes('plunge')) {
                    if (plungeMode === 'self') {
                        steps.push({
                            category: 'è¨­å‚™é ç´„ (Superuser ONLY)',
                            title: 'æ¨£æœ¬å†·å‡',
                            booking: '04. æ€¥è¡å¼å†·å‡å„€ (Superuser ONLY)',
                            note: 'å·²å–å¾—è³‡æ ¼ï¼Œå¯24å°æ™‚è‡ªè¡Œæ“ä½œ',
                            time: 'âœ… é€±é–“09:00-18:00',
                            timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                        });
                    } else {
                        steps.push({
                            category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                            title: 'æ¨£æœ¬å†·å‡',
                            booking: '04. æ€¥è¡å¼å†·å‡å„€ (å”ä½œ/è¨“ç·´èª²ç¨‹)',
                            note: 'éœ€è¦å¯¦é©—ç«™äººå“¡å”åŠ©æ“ä½œ',
                            time: 'âœ… é€±é–“09:00-18:00',
                            timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                        });
                    }
                } else if (targetStatus.includes('plunge')) {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'æ¨£æœ¬å†·å‡',
                        booking: '04. æ€¥è¡å¼å†·å‡å„€ (å”ä½œ/è¨“ç·´èª²ç¨‹)',
                        note: 'æ¥å—æ•™è‚²è¨“ç·´ä»¥å–å¾—æ“ä½œè³‡æ ¼',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                } else {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'æ¨£æœ¬å†·å‡',
                        booking: '04. æ€¥è¡å¼å†·å‡å„€ (å”ä½œ/è¨“ç·´èª²ç¨‹)',
                        note: 'å¯¦é©—ç«™äººå“¡å”åŠ©é€²è¡Œæ¨£æœ¬å†·å‡',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                }
                
                // å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å°
                if (currentStatus.includes('screen')) {
                    steps.push({
                        category: 'è¨­å‚™é ç´„ (Superuser ONLY)',
                        title: 'å†·å‡æ¨£æœ¬ç¯©é¸',
                        booking: '05. å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å° (Superuser ONLY)',
                        note: 'å·²å–å¾—è³‡æ ¼ï¼Œå¯è‡ªè¡Œæ“ä½œ',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                } else if (targetStatus.includes('screen')) {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'å†·å‡æ¨£æœ¬ç¯©é¸',
                        booking: '05. å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å° (è¨“ç·´èª²ç¨‹)',
                        note: 'æ¥å—æ•™è‚²è¨“ç·´ä»¥å–å¾—æ“ä½œè³‡æ ¼',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                } else {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'å†·å‡æ¨£æœ¬ç¯©é¸',
                        booking: '05. å†·å‡æ¨£æœ¬ç¯©é¸è¼‰å° (è¨“ç·´èª²ç¨‹)',
                        note: 'å¯¦é©—ç«™äººå“¡å”åŠ©é€²è¡Œæ¨£æœ¬ç¯©é¸',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                }
                
                // SXTå¯¦é©—ç«™
                if (currentStatus.includes('sxt')) {
                    if (sxtMode === 'self') {
                        steps.push({
                            category: 'è¨­å‚™é ç´„ (Superuser ONLY)',
                            title: 'å¯¦é©—ç«™ä¸Šæ©Ÿ (beamtime)',
                            booking: '07. SXTå¯¦é©—ç«™ (Superuser ONLY)',
                            note: 'å·²å–å¾—è³‡æ ¼ï¼Œå¯24å°æ™‚è‡ªè¡Œæ“ä½œ',
                            time: 'âœ… é€±é–“09:00-18:00',
                            timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                        });
                    } else {
                        steps.push({
                            category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                            title: 'å¯¦é©—ç«™ä¸Šæ©Ÿ (beamtime)',
                            booking: 'ç„¡éœ€é ç´„',
                            note: 'å·¥ä½œæ™‚é–“å…§ç›´æ¥è¯ç¹«å¯¦é©—ç«™äººå“¡',
                            time: 'âœ… é€±é–“09:00-18:00',
                            timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                        });
                    }
                } else if (targetStatus.includes('sxt')) {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'å¯¦é©—ç«™ä¸Šæ©Ÿ (beamtime)',
                        booking: '07. SXTå¯¦é©—ç«™ (è¨“ç·´èª²ç¨‹)',
                        note: 'åˆæ¬¡ä½¿ç”¨ï¼Œéœ€æ¥å—å®Œæ•´æ•™è‚²è¨“ç·´',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                } else {
                    steps.push({
                        category: 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„',
                        title: 'å¯¦é©—ç«™ä¸Šæ©Ÿ (beamtime)',
                        booking: '07. SXTå¯¦é©—ç«™ (è¨“ç·´èª²ç¨‹)',
                        note: 'å¯¦é©—ç«™äººå“¡å…¨ç¨‹å”åŠ©æ“ä½œ',
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                }
                
                // æŠ€è¡“æ”¯æ´
                steps.push({
                    category: 'æŠ€è¡“æ”¯æ´',
                    title: 'å½±åƒ3DåŒ–',
                    booking: '09. Imodå½±åƒé‡å»º (è¨“ç·´èª²ç¨‹)',
                    note: 'å­¸ç¿’å°‡æ—‹è½‰å½±åƒé‡å»ºç‚º3Då †ç–Šå½±åƒ',
                    optional: true,
                    time: 'âœ… é€±é–“09:00-18:00',
                    timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                });
                
                steps.push({
                    category: 'æŠ€è¡“æ”¯æ´',
                    title: '3Då½±åƒå¥—è‰²',
                    booking: '10. 3dmodå½±åƒåˆ†å‰² (è¨“ç·´èª²ç¨‹) æˆ– 10. Amiraå½±åƒåˆ†å‰² (è¨“ç·´èª²ç¨‹)',
                    note: 'é‡å°ä¸åŒçµæ§‹é€²è¡Œè¦–è¦ºåŒ–æ¨™è¨˜',
                    optional: true,
                    time: 'âœ… é€±é–“09:00-18:00',
                    timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                });
                
                if (currentStatus.includes('amira') || targetStatus.includes('amira')) {
                    steps.push({
                        category: 'è¨­å‚™é ç´„ (Superuser ONLY)',
                        title: 'Amiraå½±åƒåˆ†å‰²å·¥ä½œç«™',
                        booking: '08. Amiraå½±åƒåˆ†å‰²å·¥ä½œç«™ (Superuser ONLY)',
                        note: 'ä½¿ç”¨é«˜æ•ˆèƒ½å·¥ä½œç«™é€²è¡Œé€²éšåˆ†æ',
                        optional: true,
                        time: 'âœ… é€±é–“09:00-18:00',
                        timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                    });
                }
                
                steps.push({
                    category: 'æŠ€è¡“æ”¯æ´',
                    title: 'è³‡æ–™åˆ†æèˆ‡è¨è«–',
                    booking: '11. è³‡æ–™åˆ†æèˆ‡è¨è«– (å”ä½œ)',
                    note: 'å¯é¸æ“‡å¯¦é«”æˆ–ç·šä¸Šè¨è«–æ–¹å¼',
                    optional: true,
                    time: 'âœ… é€±é–“09:00-18:00',
                    timeUnavailable: 'âŒ é€±æœ«åŠåœ‹å®šå‡æ—¥ä¸é–‹æ”¾é ç´„'
                });
            }

            // æ·»åŠ æç¤ºä¿¡æ¯
            if (!targetStatus.includes('maintain') && targetStatus.some(t => !currentStatus.includes(t))) {
                html += `
                    <div class="info-box">
                        <div class="info-icon">â„¹ï¸</div>
                        <div>
                            <strong>æé†’ï¼š</strong>æ‚¨é¸æ“‡æˆç‚ºæ–°çš„ Superuserï¼Œç›¸é—œè¨­å‚™å°‡å®‰æ’æ•™è‚²è¨“ç·´èª²ç¨‹ã€‚
                            å®Œæˆè¨“ç·´å¾Œï¼Œå³å¯ç²å¾—è©²è¨­å‚™çš„ç¨ç«‹æ“ä½œè³‡æ ¼ã€‚
                        </div>
                    </div>
                `;
            }

            // æ ¹æ“šæª¢è¦–æ¨¡å¼ç”Ÿæˆå…§å®¹
            if (viewMode === 'category') {
                // æŒ‰åˆ†é¡çµ„ç¹”æ­¥é©Ÿ
                const categoryOrder = ['è¨­å‚™é ç´„', 'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„', 'è¨­å‚™é ç´„ (Superuser ONLY)', 'æŠ€è¡“æ”¯æ´'];
                const groupedSteps = {};
                
                steps.forEach((step, index) => {
                    step.number = index + 1;
                    if (!groupedSteps[step.category]) {
                        groupedSteps[step.category] = [];
                    }
                    groupedSteps[step.category].push(step);
                });

                // ç”Ÿæˆåˆ†é¡çš„é ç´„æ­¥é©Ÿ
                categoryOrder.forEach(category => {
                    if (groupedSteps[category] && groupedSteps[category].length > 0) {
                        html += `<div class="booking-category">${getCategoryIcon(category)} ${category}</div>`;
                        
                        groupedSteps[category].forEach(step => {
                            html += generateStepHTML(step);
                        });
                    }
                });
            } else {
                // å¯¦é©—é †åºï¼ˆåŸå§‹é †åºï¼‰
                steps.forEach((step, index) => {
                    step.number = index + 1;
                    html += generateStepHTML(step);
                });
            }

            return html;
        }

        function generateStepHTML(step) {
            return `
                <div class="booking-step">
                    <div class="step-number">${step.number}</div>
                    <div class="step-content">
                        <div class="step-title">
                            ${step.title}
                            ${step.optional ? '<span class="optional-tag">é¸æ“‡æ€§</span>' : ''}
                        </div>
                        <div class="step-booking">${step.booking}</div>
                        <div class="step-note">${step.note}</div>
                        <div class="step-time">
                            <span class="time-available">${step.time}</span>
                            <span class="time-unavailable">${step.timeUnavailable}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function getCategoryIcon(category) {
            const icons = {
                'è¨­å‚™é ç´„': 'ğŸ“‹',
                'è¨­å‚™é ç´„ (Superuser ONLY)': 'ğŸ”“',
                'è¨­å‚™å”ä½œ/è¨“ç·´èª²ç¨‹é ç´„': 'ğŸ¤',
                'æŠ€è¡“æ”¯æ´': 'ğŸ’¡'
            };
            return icons[category] || 'ğŸ“Œ';
        }

        function resetForm() {
            document.getElementById('results').style.display = 'none';
            document.getElementById('selectionForm').style.display = 'block';
            
            // é‡ç½®æ‰€æœ‰é¸é …
            selectedSample = '';
            currentStatus = [];
            targetStatus = [];
            viewMode = 'sequence';
            
            // æ¸…é™¤æ‰€æœ‰é¸æ“‡ç‹€æ…‹
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected', 'disabled');
            });
            
            document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(input => {
                if (input.type === 'checkbox') {
                    input.checked = false;
                    input.disabled = false;
                } else if (input.name === 'sample') {
                    input.checked = false;
                } else if (input.value === 'self') {
                    input.checked = true;
                }
            });
            
            // éš±è—å­é¸é …
            document.querySelectorAll('.sub-options').forEach(sub => {
                sub.style.display = 'none';
            });
            
            // æ¢å¾©Cå€å¡Šç¶­æŒåŸæœ‰èº«ä»½é¸é …
            const maintainEl = document.getElementById('target-maintain');
            maintainEl.closest('.option-card').classList.remove('disabled');
            maintainEl.disabled = false;
        }
    </script>
</body>
</html>